import strapiApi from '../lib/strapiApi';
import { StrapiArticle, StrapiCategory, StrapiAuthor } from '../lib/types/strapi';

// N√°hodn√° data pro generov√°n√≠ obsahu
const categories = [
  { name: 'Umƒõl√° inteligence', slug: 'umela-inteligence', description: 'ƒål√°nky o AI technologi√≠ch a jejich aplikac√≠ch' },
  { name: 'Machine Learning', slug: 'machine-learning', description: 'Pokroƒçil√© techniky strojov√©ho uƒçen√≠' },
  { name: 'Automatizace', slug: 'automatizace', description: 'Automatizace proces≈Ø pomoc√≠ AI' },
  { name: 'Data Science', slug: 'data-science', description: 'Anal√Ωza dat a prediktivn√≠ modelov√°n√≠' },
  { name: 'Technologie', slug: 'technologie', description: 'Nejnovƒõj≈°√≠ technologick√© trendy' },
  { name: 'Business AI', slug: 'business-ai', description: 'AI ≈ôe≈°en√≠ pro podnik√°n√≠' }
];

const authors = [
  { name: 'Jan Nov√°k', email: 'jan.novak@expandmatrix.com', bio: 'Expert na umƒõlou inteligenci s 10letou prax√≠' },
  { name: 'Marie Svobodov√°', email: 'marie.svobodova@expandmatrix.com', bio: 'Specialistka na machine learning a data science' },
  { name: 'Petr Dvo≈ô√°k', email: 'petr.dvorak@expandmatrix.com', bio: 'Konzultant pro AI automatizaci v podnic√≠ch' },
  { name: 'Anna Kr√°sn√°', email: 'anna.krasna@expandmatrix.com', bio: 'V√Ωvoj√°≈ôka AI aplikac√≠ a chatbot≈Ø' }
];

const articleTitles = [
  'Jak AI mƒõn√≠ zp≈Øsob pr√°ce v modern√≠ch firm√°ch',
  'Machine Learning: Od z√°klad≈Ø k pokroƒçil√Ωm technik√°m',
  'Automatizace z√°kaznick√©ho servisu pomoc√≠ chatbot≈Ø',
  'Prediktivn√≠ anal√Ωza v e-commerce: Praktick√Ω pr≈Øvodce',
  'Etick√© aspekty umƒõl√© inteligence v roce 2024',
  'Implementace AI v mal√Ωch a st≈ôedn√≠ch podnic√≠ch',
  'Deep Learning pro zpracov√°n√≠ p≈ôirozen√©ho jazyka',
  'Computer Vision: Revoluce v anal√Ωze obrazu',
  'AI v healthcare: Budoucnost medic√≠ny',
  'Optimalizace proces≈Ø pomoc√≠ reinforcement learning',
  'Generativn√≠ AI: Kreativita v rukou stroj≈Ø',
  'Bezpeƒçnost AI syst√©m≈Ø: V√Ωzvy a ≈ôe≈°en√≠',
  'Edge AI: Umƒõl√° inteligence na okraji s√≠tƒõ',
  'Transformace HR proces≈Ø pomoc√≠ AI',
  'AI v marketingu: Personalizace na nov√© √∫rovni'
];

const contentTemplates = [
  `Umƒõl√° inteligence se st√°v√° neodmyslitelnou souƒç√°st√≠ modern√≠ho podnik√°n√≠. V tomto ƒçl√°nku se pod√≠v√°me na konkr√©tn√≠ zp≈Øsoby, jak AI transformuje r≈Øzn√© oblasti.

## Hlavn√≠ oblasti aplikace

AI nach√°z√≠ uplatnƒõn√≠ v mnoha oblastech:
- Automatizace rutinn√≠ch √∫kol≈Ø
- Anal√Ωza velk√Ωch dat
- Prediktivn√≠ modelov√°n√≠
- Personalizace z√°kaznick√© zku≈°enosti

## Praktick√© p≈ô√≠klady

Mnoho spoleƒçnost√≠ ji≈æ √∫spƒõ≈°nƒõ implementovalo AI ≈ôe≈°en√≠. Nap≈ô√≠klad:

### Z√°kaznick√Ω servis
Chatboti a virtu√°ln√≠ asistenti dok√°≈æ√≠ vy≈ôe≈°it a≈æ 80% z√°kladn√≠ch dotaz≈Ø z√°kazn√≠k≈Ø.

### Marketing
AI algoritmy optimalizuj√≠ reklamn√≠ kampanƒõ v re√°ln√©m ƒçase.

## Budouc√≠ trendy

Oƒçek√°v√°me dal≈°√≠ rozvoj v oblastech:
1. Explainable AI
2. Federated Learning
3. AI Ethics

## Z√°vƒõr

Implementace AI nen√≠ jen technologick√° v√Ωzva, ale strategick√© rozhodnut√≠, kter√© m≈Ø≈æe z√°sadnƒõ ovlivnit konkurenceschopnost firmy.`,
  
  `Machine learning p≈ôedstavuje jednu z nejdynamiƒçtƒõji se rozv√≠jej√≠c√≠ch oblast√≠ informatiky. Tento ƒçl√°nek poskytuje komplexn√≠ p≈ôehled z√°kladn√≠ch i pokroƒçil√Ωch technik.

## Z√°kladn√≠ koncepty

### Supervised Learning
Uƒçen√≠ s uƒçitelem vyu≈æ√≠v√° oznaƒçen√° data pro tr√©nov√°n√≠ model≈Ø.

### Unsupervised Learning
Uƒçen√≠ bez uƒçitele hled√° skryt√© vzory v neoznaƒçen√Ωch datech.

### Reinforcement Learning
Posilovan√© uƒçen√≠ se zamƒõ≈ôuje na optimalizaci rozhodov√°n√≠.

## Popul√°rn√≠ algoritmy

- **Random Forest**: Ensemble metoda pro klasifikaci i regresi
- **Neural Networks**: Inspirovan√© biologick√Ωmi neurony
- **SVM**: Support Vector Machines pro klasifikaci
- **K-means**: Clustering algoritmus

## Praktick√© aplikace

Machine learning se pou≈æ√≠v√° v:
- Rozpozn√°v√°n√≠ obrazu
- Zpracov√°n√≠ p≈ôirozen√©ho jazyka
- Doporuƒçovac√≠ch syst√©mech
- Finanƒçn√≠m modelov√°n√≠

## V√Ωzvy a omezen√≠

P≈ôi implementaci ML je t≈ôeba zv√°≈æit:
- Kvalitu a mno≈æstv√≠ dat
- V√Ωpoƒçetn√≠ n√°roƒçnost
- Interpretabilitu model≈Ø
- Etick√© aspekty

## Budoucnost ML

Oƒçek√°v√°me pokroky v:
- AutoML platform√°ch
- Kvantov√©m machine learningu
- Neuromorphic computing`,
  
  `Automatizace pomoc√≠ umƒõl√© inteligence revolucionizuje zp≈Øsob, jak√Ωm firmy p≈ôistupuj√≠ k rutinn√≠m proces≈Øm. Tento ƒçl√°nek zkoum√° mo≈ænosti a v√Ωhody AI automatizace.

## Co je AI automatizace?

AI automatizace kombinuje tradiƒçn√≠ automatizaci s inteligentn√≠mi algoritmy, kter√© dok√°≈æ√≠:
- Rozhodovat na z√°kladƒõ kontextu
- Uƒçit se z dat
- Adaptovat se na zmƒõny

## Kl√≠ƒçov√© oblasti aplikace

### Finanƒçn√≠ procesy
- Automatick√© zpracov√°n√≠ faktur
- Detekce podvod≈Ø
- Compliance monitoring

### HR procesy
- Screening ≈æivotopis≈Ø
- Pl√°nov√°n√≠ smƒõn
- Performance analytics

### V√Ωroba
- Prediktivn√≠ √∫dr≈æba
- Kontrola kvality
- Optimalizace v√Ωroby

## Implementaƒçn√≠ strategie

1. **Identifikace proces≈Ø**: Najdƒõte repetitivn√≠ √∫koly
2. **Anal√Ωza dat**: Ovƒõ≈ôte dostupnost kvalitn√≠ch dat
3. **Pilotn√≠ projekt**: Zaƒçnƒõte s mal√Ωm rozsahem
4. **≈†k√°lov√°n√≠**: Postupnƒõ roz≈°i≈ôujte na dal≈°√≠ oblasti

## ROI a metriky

√öspƒõch AI automatizace mƒõ≈ôte pomoc√≠:
- √öspory ƒçasu
- Sn√≠≈æen√≠ chybovosti
- Zv√Ω≈°en√≠ produktivity
- Spokojenost zamƒõstnanc≈Ø

## V√Ωzvy implementace

- Change management
- ≈†kolen√≠ zamƒõstnanc≈Ø
- Integrace se st√°vaj√≠c√≠mi syst√©my
- Bezpeƒçnost dat`
];

class ContentGenerator {
  private createdCategories: any[] = [];
  private createdAuthors: any[] = [];

  private getRandomElement<T>(array: T[]): T {
    return array[Math.floor(Math.random() * array.length)];
  }

  private generateSlug(title: string): string {
    return title
      .toLowerCase()
      .replace(/[^a-z0-9\s-]/g, '')
      .replace(/\s+/g, '-')
      .replace(/-+/g, '-')
      .trim();
  }

  private generateContent(): string {
    const template = this.getRandomElement(contentTemplates);
    return template;
  }

  async createCategories(): Promise<void> {
    console.log('üè∑Ô∏è  Vytv√°≈ôen√≠ kategori√≠...');
    
    for (const category of categories) {
      try {
        const response = await fetch(`${process.env.STRAPI_API_URL}/api/categories`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${process.env.STRAPI_API_TOKEN}`
          },
          body: JSON.stringify({
            data: {
              name: category.name,
              slug: category.slug,
              description: category.description
            }
          })
        });

        if (response.ok) {
          const result = await response.json();
          this.createdCategories.push(result.data);
          console.log(`‚úÖ Kategorie "${category.name}" vytvo≈ôena`);
        } else {
          console.log(`‚ö†Ô∏è  Kategorie "${category.name}" ji≈æ existuje nebo do≈°lo k chybƒõ`);
        }
      } catch (error) {
        console.error(`‚ùå Chyba p≈ôi vytv√°≈ôen√≠ kategorie "${category.name}":`, error);
      }
    }
  }

  async createAuthors(): Promise<void> {
    console.log('üë• Vytv√°≈ôen√≠ autor≈Ø...');
    
    for (const author of authors) {
      try {
        const response = await fetch(`${process.env.STRAPI_API_URL}/api/authors`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${process.env.STRAPI_API_TOKEN}`
          },
          body: JSON.stringify({
            data: {
              name: author.name,
              email: author.email,
              bio: author.bio
            }
          })
        });

        if (response.ok) {
          const result = await response.json();
          this.createdAuthors.push(result.data);
          console.log(`‚úÖ Autor "${author.name}" vytvo≈ôen`);
        } else {
          console.log(`‚ö†Ô∏è  Autor "${author.name}" ji≈æ existuje nebo do≈°lo k chybƒõ`);
        }
      } catch (error) {
        console.error(`‚ùå Chyba p≈ôi vytv√°≈ôen√≠ autora "${author.name}":`, error);
      }
    }
  }

  async fetchExistingData(): Promise<void> {
    try {
      // Naƒçten√≠ existuj√≠c√≠ch kategori√≠
      const categoriesResponse = await fetch(`${process.env.STRAPI_API_URL}/api/categories`, {
        headers: {
          'Authorization': `Bearer ${process.env.STRAPI_API_TOKEN}`
        }
      });
      
      if (categoriesResponse.ok) {
        const categoriesData = await categoriesResponse.json();
        this.createdCategories = categoriesData.data || [];
      }

      // Naƒçten√≠ existuj√≠c√≠ch autor≈Ø
      const authorsResponse = await fetch(`${process.env.STRAPI_API_URL}/api/authors`, {
        headers: {
          'Authorization': `Bearer ${process.env.STRAPI_API_TOKEN}`
        }
      });
      
      if (authorsResponse.ok) {
        const authorsData = await authorsResponse.json();
        this.createdAuthors = authorsData.data || [];
      }
    } catch (error) {
      console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ existuj√≠c√≠ch dat:', error);
    }
  }

  async createArticles(count: number = 15): Promise<void> {
    console.log(`üìù Vytv√°≈ôen√≠ ${count} ƒçl√°nk≈Ø...`);
    
    if (this.createdCategories.length === 0 || this.createdAuthors.length === 0) {
      console.error('‚ùå Nejprve mus√≠ b√Ωt vytvo≈ôeny kategorie a auto≈ôi');
      return;
    }

    for (let i = 0; i < count; i++) {
      const title = this.getRandomElement(articleTitles);
      const slug = this.generateSlug(title);
      const content = this.generateContent();
      const category = this.getRandomElement(this.createdCategories);
      const author = this.getRandomElement(this.createdAuthors);
      
      // N√°hodn√© datum v posledn√≠ch 30 dnech
      const publishedAt = new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString();

      try {
        const response = await fetch(`${process.env.STRAPI_API_URL}/api/articles`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${process.env.STRAPI_API_TOKEN}`
          },
          body: JSON.stringify({
            data: {
              title: `${title} ${i + 1}`,
              slug: `${slug}-${i + 1}`,
              content: content,
              excerpt: content.substring(0, 200) + '...',
              publishedAt: publishedAt,
              category: category.id || category.documentId,
              author: author.id || author.documentId,
              featured: Math.random() < 0.3, // 30% ≈°ance na featured
              status: 'published'
            }
          })
        });

        if (response.ok) {
          const result = await response.json();
          console.log(`‚úÖ ƒål√°nek "${title} ${i + 1}" vytvo≈ôen`);
        } else {
          const errorData = await response.text();
          console.error(`‚ùå Chyba p≈ôi vytv√°≈ôen√≠ ƒçl√°nku "${title} ${i + 1}":`, errorData);
        }
      } catch (error) {
        console.error(`‚ùå Chyba p≈ôi vytv√°≈ôen√≠ ƒçl√°nku "${title} ${i + 1}":`, error);
      }

      // Kr√°tk√° pauza mezi po≈æadavky
      await new Promise(resolve => setTimeout(resolve, 100));
    }
  }

  async generateAllContent(): Promise<void> {
    console.log('üöÄ Spou≈°tƒõn√≠ generov√°n√≠ testovac√≠ho obsahu...');
    
    try {
      // Naƒçten√≠ existuj√≠c√≠ch dat
      await this.fetchExistingData();
      
      // Vytvo≈ôen√≠ kategori√≠ (pokud neexistuj√≠)
      if (this.createdCategories.length === 0) {
        await this.createCategories();
      } else {
        console.log(`‚ÑπÔ∏è  Nalezeno ${this.createdCategories.length} existuj√≠c√≠ch kategori√≠`);
      }
      
      // Vytvo≈ôen√≠ autor≈Ø (pokud neexistuj√≠)
      if (this.createdAuthors.length === 0) {
        await this.createAuthors();
      } else {
        console.log(`‚ÑπÔ∏è  Nalezeno ${this.createdAuthors.length} existuj√≠c√≠ch autor≈Ø`);
      }
      
      // Vytvo≈ôen√≠ ƒçl√°nk≈Ø
      await this.createArticles(15);
      
      console.log('üéâ Generov√°n√≠ obsahu dokonƒçeno!');
      
    } catch (error) {
      console.error('‚ùå Chyba p≈ôi generov√°n√≠ obsahu:', error);
    }
  }
}

// Spu≈°tƒõn√≠ gener√°toru
if (require.main === module) {
  const generator = new ContentGenerator();
  generator.generateAllContent();
}

export default ContentGenerator;